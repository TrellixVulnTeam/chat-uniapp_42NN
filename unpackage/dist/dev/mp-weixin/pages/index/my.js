(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/my"],{73:function(e,n,o){"use strict";(function(e){o(5);t(o(3));var n=t(o(74));function t(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(n.default)}).call(this,o(1)["createPage"])},74:function(e,n,o){"use strict";o.r(n);var t=o(75),r=o(77);for(var c in r)"default"!==c&&function(e){o.d(n,e,(function(){return r[e]}))}(c);o(80);var a,s=o(23),i=Object(s["default"])(r["default"],t["render"],t["staticRenderFns"],!1,null,"810f65fc",null,!1,t["components"],a);i.options.__file="pages/index/my.vue",n["default"]=i.exports},75:function(e,n,o){"use strict";o.r(n);var t=o(76);o.d(n,"render",(function(){return t["render"]})),o.d(n,"staticRenderFns",(function(){return t["staticRenderFns"]})),o.d(n,"recyclableRender",(function(){return t["recyclableRender"]})),o.d(n,"components",(function(){return t["components"]}))},76:function(e,n,o){"use strict";var t;o.r(n),o.d(n,"render",(function(){return r})),o.d(n,"staticRenderFns",(function(){return a})),o.d(n,"recyclableRender",(function(){return c})),o.d(n,"components",(function(){return t}));try{t={uAvatar:function(){return o.e("uni_modules/uview-ui/components/u-avatar/u-avatar").then(o.bind(null,336))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,n=e.$createElement;e._self._c},c=!1,a=[];r._withStripped=!0},77:function(e,n,o){"use strict";o.r(n);var t=o(78),r=o.n(t);for(var c in t)"default"!==c&&function(e){o.d(n,e,(function(){return t[e]}))}(c);n["default"]=r.a},78:function(e,n,o){"use strict";(function(e,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(79),c={data:function(){return{isLogin:!1,userInfo:{},memberId:"",memberLevel:"普通会员",validDate:"",wechatNumber:""}},onLoad:function(){this.init()},methods:{init:function(){var n=this,o=e.database();o.collection("chat-member").field("max(memberId) as maxMemberId").get().then((function(e){console.log("chat-member:",e);var o=e.result.data[0].maxMemberId;n.memberId=parseInt(o)+1,console.log(n.maxMemberId)})).catch((function(e){console.error(e)})),o.collection("chat-config").where('config_type=="weixin" && item_code=="'+r.APP_OWNER+'" && enable=="Y"').get().then((function(e){n.wechatNumber=e.result.data[0].item_content,console.log("chat-config:",e),console.log("wechatNumber:",n.wechatNumber)})).catch((function(e){console.log(e.code),console.log(e.message)}));var t=new Date,c=this.$formatter.addMonth(t,1);this.validDate=this.$formatter.timeFormat(c,"yyyy-mm-dd"),console.log("validDate:",this.validDate)},login:function(){console.log("login");var n=this;t.showModal({title:"温馨提示",content:"授权微信登录后才能正常使用小程序功能",success:function(o){console.log("login res:",o),o.confirm?t.getUserProfile({desc:"注册用户信息使用",lang:"zh_CN",success:function(o){console.log("userProfileRes",o),t.login({provider:"weixin",success:function(r){console.log("loginRes",r),e.callFunction({name:"chat-member",data:{code:r.code}}).then((function(e){console.log("callFunction res",e),console.log("callFunction openid",e.result.data.openid),console.log("callFunction session_key",e.result.data.session_key),n.userInfo.nickName=o.userInfo.nickName,n.userInfo.gender=o.userInfo.gender,n.userInfo.avatarUrl=o.userInfo.avatarUrl,n.userInfo.memberId=n.memberId,n.userInfo.memberLevel=n.memberLevel,n.userInfo.validDate=n.validDate,n.userInfo.code=r.code,n.userInfo.openid=e.result.data.openid,n.userInfo.session_key=e.result.data.session_key,console.log("userInfo:",n.userInfo),t.setStorageSync("userInfo",n.userInfo),n.isLogin=!0,n.createMember()}))}})},fail:function(e){console.log("fail res:",e)}}):t.showToast({title:"您取消了授权",duration:2e3})}})},createMember:function(){console.log("createMember userInfo:",this.userInfo);var n=e.database();n.collection("chat-member").add(this.userInfo).then((function(e){console.log("createMember e:",e)}))},copy:function(){t.setClipboardData({data:this.wechatNumber,success:function(){t.showToast({title:"已经复制",icon:"none"})}})}}};n.default=c}).call(this,o(10)["default"],o(1)["default"])},80:function(e,n,o){"use strict";o.r(n);var t=o(81),r=o.n(t);for(var c in t)"default"!==c&&function(e){o.d(n,e,(function(){return t[e]}))}(c);n["default"]=r.a},81:function(e,n,o){}},[[73,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/my.js.map