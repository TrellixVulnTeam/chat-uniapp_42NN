{"version":3,"sources":["webpack:///./node_modules/@dcloudio/uni-cli-shared/components/unicloud-db.vue?a036","webpack:///./node_modules/@dcloudio/uni-cli-shared/components/unicloud-db.vue?4f18","webpack:///./node_modules/@dcloudio/uni-cli-shared/components/unicloud-db.vue?7ac1","webpack:///./node_modules/@dcloudio/uni-cli-shared/components/unicloud-db.vue?17d5","webpack:///node_modules/@dcloudio/uni-cli-shared/components/unicloud-db.vue?5078"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","$setScopedSlotsParams","data","dataList","pagination","paginationInternal","loading","hasMore","error","errorMessage","recyclableRender","staticRenderFns","_withStripped","load","add","replace","auto","onready","manual","name","props","type","Object","Array","default","spaceInfo","collection","String","action","field","orderby","where","pageData","pageCurrent","Number","pageSize","getcount","Boolean","getone","gettree","gettreepath","startwith","limitlevel","groupby","groupField","distinct","pageIndistinct","foreignKey","loadtime","undefined","computed","collectionArgs","isArray","isLookup","mainCollection","split","mainQuery","$db","$param","created","_isEnded","current","size","count","$watch","al","attrs","forEach","push","newValue","oldValue","i","needReset","loadMode","loadData","methods","args1","clear","pageMode","reset","args2","callback","_execLoadData","loadMore","refresh","needLoading","uni","showLoading","title","loadingTitle","db","value","then","success","res","showToast","toastTitle","t","fail","err","needConfirm","showModal","content","message","showCancel","hideLoading","complete","remove","id","length","confirmTitle","confirmContent","confirm","_execRemove","update","doc","getTemp","keys","groupBy","orderBy","getOptions","getCount","limitLevel","startWith","getTree","treeOptions","getTreePath","skip","limit","isTemp","udb","get","setResult","result","code","_execLoadDataSuccess","_execLoadDataFail","Error","_getExec","data2","_dispatchEvent","events","$emit","console","ids","mask","exec","_id","dbCmd","in","removeData","index","dl","splice","il","_changeDataFunction"],"mappings":"6JAAA,kHACIA,EADJ,QAQIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,oIACZ,aAAAF,E,0CCtBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,GAEjBL,EAAIM,sBAAsB,UAAW,CACnCV,QAASI,EAAIJ,QACbW,KAAMP,EAAIQ,SACVC,WAAYT,EAAIU,mBAChBC,QAASX,EAAIW,QACbC,QAASZ,EAAIY,QACbC,MAAOb,EAAIc,gBAIbC,GAAmB,EACnBC,EAAkB,GACtBjB,EAAOkB,eAAgB,G,iCClBvB,8GAAmW,eAAG,G,kHCctW,WACA,Y,qyBAEA,8B,EAAA,EAEA,GACEC,KAAM,OACNL,MAAO,SAET,GACEM,IAAK,MACLC,QAAS,WAEX,GACEC,KAAM,OACNC,QAAS,UACTC,OAAQ,UAGV,GACA,cACA,WACA,YACA,aACA,SACA,QACA,WACA,UACA,QACA,UACA,aACA,Y,EAGA,CACEC,KAAM,aACNC,MAAO,CACL7B,QAAS,CACP8B,KAAM,CAACC,OAAQC,OACfC,QAFN,WAGQ,MAAO,KAGXC,UAAW,CACTJ,KAAMC,OACNE,QAFN,WAGQ,MAAO,KAGXE,WAAY,CACVL,KAAM,CAACM,OAAQJ,OACfC,QAAS,IAEXI,OAAQ,CACNP,KAAMM,OACNH,QAAS,IAEXK,MAAO,CACLR,KAAMM,OACNH,QAAS,IAEXM,QAAS,CACPT,KAAMM,OACNH,QAAS,IAEXO,MAAO,CACLV,KAAM,CAACM,OAAQL,QACfE,QAAS,IAEXQ,SAAU,CACRX,KAAMM,OACNH,QAAS,OAEXS,YAAa,CACXZ,KAAMa,OACNV,QAAS,GAEXW,SAAU,CACRd,KAAMa,OACNV,QAAS,IAEXY,SAAU,CACRf,KAAM,CAACgB,QAASV,QAChBH,SAAS,GAEXc,OAAQ,CACNjB,KAAM,CAACgB,QAASV,QAChBH,SAAS,GAEXe,QAAS,CACPlB,KAAM,CAACgB,QAASV,OAAQL,QACxBE,SAAS,GAEXgB,YAAa,CACXnB,KAAM,CAACgB,QAASV,QAChBH,SAAS,GAEXiB,UAAW,CACTpB,KAAMM,OACNH,QAAS,IAEXkB,WAAY,CACVrB,KAAMa,OACNV,QAAS,IAEXmB,QAAS,CACPtB,KAAMM,OACNH,QAAS,IAEXoB,WAAY,CACVvB,KAAMM,OACNH,QAAS,IAEXqB,SAAU,CACRxB,KAAM,CAACgB,QAASV,QAChBH,SAAS,GAEXsB,eAAgB,CACdzB,KAAM,CAACgB,QAASV,QAChBH,SAAS,GAEXuB,WAAY,CACV1B,KAAMM,OACNH,QAAS,IAEXwB,SAAU,CACR3B,KAAMM,OACNH,QAAS,QAEXN,OAAQ,CACNG,KAAMgB,QACNb,SAAS,IAGbtB,KApGF,WAqGI,MAAO,CACLI,SAAS,EACTC,SAAS,EACTJ,SAAUP,KAAK0C,YAASW,EAAY,GACpC5C,mBAAoB,GACpBI,aAAc,KAGlByC,SAAU,CACRC,eADJ,WAEM,OAAO5B,MAAM6B,QAAQxD,KAAK8B,YAAc9B,KAAK8B,WAAa,CAAC9B,KAAK8B,aAElE2B,SAJJ,WAKM,OAAO,MAAb,wHAEIC,eAPJ,WAQM,GAA+B,kBAApB1D,KAAK8B,WACd,OAAO9B,KAAK8B,WAAW6B,MAAM,KAAK,GAEpC,IAAN,iDACM,OAAOC,EAAUC,IAAI,GAAGC,OAAO,KAGnCC,QA5HF,WA4HA,WACI/D,KAAKgE,UAAW,EAChBhE,KAAKS,mBAAqB,CACxBwD,QAASjE,KAAKqC,YACd6B,KAAMlE,KAAKuC,SACX4B,MAAO,GAGTnE,KAAKoE,QAAO,WACV,IAAIC,EAAK,GAIT,OAHAC,EAAMC,SAAQ,SAApB,GACQF,EAAGG,KAAK,EAAhB,OAEaH,KACb,cAKM,GAJA,EAAN,mCACUI,EAAS,KAAOC,EAAS,KAC3B,EAAR,0CAEU,EAAV,oBAAM,CAKA,IADA,IAAN,KACA,mBACQ,GAAID,EAASE,KAAOD,EAASC,GAAI,CAC/BC,GAAY,EACZ,MAGAA,IACF,EAAR,QACQ,EAAR,SAGM,EAAN,oBA2CS5E,KAAKsB,QAAUtB,KAAKoD,WAAayB,EAASzD,MAC7CpB,KAAK8E,YAiBTC,QAAS,CACPD,SADJ,SACA,KACM,IAAN,OACA,KAC2B,kBAAVE,GACLA,EAAMC,QACJjF,KAAKoC,WAAa8C,EAAS/D,QAC7BnB,KAAKiF,QAELA,EAAQD,EAAMC,MAEhBjF,KAAKmF,cAEe9B,IAAlB2B,EAAMf,UACRjE,KAAKS,mBAAmBwD,QAAUe,EAAMf,SAErB,oBAAVmB,IACTC,EAAWD,IAErB,wBACQC,EAAWL,GAGbhF,KAAKsF,cAAcD,EAAUJ,IAE/BM,SAzBJ,WA0BUvF,KAAKgE,UAAYhE,KAAKU,UAItBV,KAAKoC,WAAa8C,EAAShE,KAC7BlB,KAAKS,mBAAmBwD,UAG1BjE,KAAKsF,kBAEPE,QApCJ,WAqCMxF,KAAKiF,QACLjF,KAAKsF,iBAEPL,MAxCJ,WAyCMjF,KAAKgE,UAAW,EAChBhE,KAAKO,SAAW,IAElB4E,MA5CJ,WA6CMnF,KAAKS,mBAAmBwD,QAAU,GAEpC/C,IA/CJ,SA+CA,GAUA,gEATA,EASA,EATA,OASA,IARA,iBAQA,SAPA,EAOA,EAPA,WACA,EAMA,EANA,QACA,EAKA,EALA,KACA,EAIA,EAJA,SAIA,IAHA,mBAGA,aAFA,mBAEA,aADA,oBACA,MADA,GACA,EACUuE,GACFC,EAAIC,YAAY,CACdC,MAAOC,IAIX,IAAN,6BACU7D,IACF8D,EAAKA,EAAG9D,OAAOA,IAGjB8D,EAAGhE,WAAW9B,KAAK0D,gBAAgBxC,IAAI6E,GAAOC,MAAK,SAAzD,GACQC,GAAWA,EAAQC,GACfC,GACFT,EAAIS,UAAU,CACZP,MAAOQ,GAAcC,EAAE,uCAGnC,mBACQC,GAAQA,EAAKC,GACTC,GACFd,EAAIe,UAAU,CACZC,QAASH,EAAII,QACbC,YAAY,OAGxB,oBACYnB,GACFC,EAAImB,cAENC,GAAYA,QAGhBC,OA3FJ,SA2FA,GAUA,uEATA,EASA,EATA,OACA,EAQA,EARA,QACA,EAOA,EAPA,KACA,EAMA,EANA,SACA,EAKA,EALA,aACA,EAIA,EAJA,eAIA,IAHA,mBAGA,aAFA,mBAEA,aADA,oBACA,MADA,GACA,EACWC,GAAOA,EAAGC,SAGVT,EAILd,EAAIe,UAAU,CACZb,MAAOsB,GAAgBb,EAAE,6CACzBK,QAASS,GAAkBd,EAAE,+CAC7BO,YAAY,EACZX,QAAS,SAAjB,GACeC,EAAIkB,SAGT,EAAV,gCAXQpH,KAAKqH,YAAYL,EAAIhF,EAAQ,EAArC,aAeIsF,OAzHJ,SAyHA,KAUA,gEATA,EASA,EATA,OASA,IARA,iBAQA,SAPA,EAOA,EAPA,WACA,EAMA,EANA,QACA,EAKA,EALA,KACA,EAIA,EAJA,SAIA,IAHA,mBAGA,aAFA,mBAEA,aADA,oBACA,MADA,GACA,EACU7B,GACFC,EAAIC,YAAY,CACdC,MAAOC,IAIX,IAAN,6BAKM,OAJI7D,IACF8D,EAAKA,EAAG9D,OAAOA,IAGV8D,EAAGhE,WAAW9B,KAAK0D,gBAAgB6D,IAAIP,GAAIM,OAAOvB,GAAOC,MAAK,SAA3E,GACQC,GAAWA,EAAQC,GACfC,GACFT,EAAIS,UAAU,CACZP,MAAOQ,GAAcC,EAAE,0CAGnC,mBACQC,GAAQA,EAAKC,GACTC,GACFd,EAAIe,UAAU,CACZC,QAASH,EAAII,QACbC,YAAY,OAGxB,oBACYnB,GACFC,EAAImB,cAENC,GAAYA,QAGhBU,QArKJ,WAqKA,mEAEA,6BAEUxH,KAAKgC,SACP8D,EAAKA,EAAG9D,OAAOhC,KAAKgC,SAGtB8D,GAAN,gDAEa9F,KAAKmC,OAAUT,OAAO+F,KAAKzH,KAAKmC,OAAO8E,SAC5CnB,EAAKA,EAAG3D,MAAMnC,KAAKmC,QAEjBnC,KAAKiC,QACP6D,EAAKA,EAAG7D,MAAMjC,KAAKiC,QAEjBjC,KAAKmD,aACP2C,EAAKA,EAAG3C,WAAWnD,KAAKmD,aAEtBnD,KAAK+C,UACP+C,EAAKA,EAAG4B,QAAQ1H,KAAK+C,UAEnB/C,KAAKgD,aACP8C,EAAKA,EAAG9C,WAAWhD,KAAKgD,cAEJ,IAAlBhD,KAAKiD,WACP6C,EAAKA,EAAG7C,YAENjD,KAAKkC,UACP4D,EAAKA,EAAG6B,QAAQ3H,KAAKkC,UA7B7B,MAmCM,KAAN,mBAFA,EAjCA,EAiCA,QACA,EAlCA,EAkCA,KAEA,KACUlC,KAAKwC,WACPoF,EAAWC,SAAW7H,KAAKwC,UAE7B,IAAN,GACQsF,WAAY9H,KAAK8C,WACjBiF,UAAW/H,KAAK6C,WAiBlB,OAfI7C,KAAK2C,UACPiF,EAAWI,QAAUC,GAEnBjI,KAAK4C,cACPgF,EAAWM,YAAcD,GAE3BnC,EAAKA,EAAGqC,KAAKjE,GAAQD,EAAU,IAAImE,MAAMlE,GAErCmE,GACFvC,EAAKA,EAAG0B,QAAQI,GAChB9B,EAAGwC,IAAMtI,MAET8F,EAAKA,EAAGyC,IAAIX,GAGP9B,GAET0C,UAlOJ,SAkOA,GAC0B,IAAhBC,EAAOC,KACT1I,KAAK2I,qBAAqBF,GAE1BzI,KAAK4I,kBAAkB,IAAIC,MAAMJ,EAAO9B,WAG5CrB,cAzOJ,SAyOA,gBACUtF,KAAKU,UAGTV,KAAKU,SAAU,EACfV,KAAKa,aAAe,GAEpBb,KAAK8I,WAAW9C,MAAK,SAA3B,GACQ,EAAR,WACQ,EAAR,sCAaA,mBACQ,EAAR,WACQ,EAAR,4BAGI2C,qBApQJ,SAoQA,WAEM,EAEA,EAFN,KACA,EACA,EADA,MAEM3I,KAAKgE,cAAqBX,IAAVc,EAAsB,KAA5C,kFACMnE,KAAKW,SAAWX,KAAKgE,SAErB,IAcN,EAdA,sCAEUhE,KAAKwC,WACPxC,KAAKS,mBAAmB0D,MAAQA,GAGlCkB,GAAYA,EAAS0D,EAAO/I,KAAKgE,SAAUhE,KAAKS,oBAChDT,KAAKgJ,eAAeC,EAAOhI,KAAM8H,GAE7B/I,KAAK0C,QAAU1C,KAAKoC,WAAa8C,EAAS/D,SAC5CnB,KAAKO,SAAWwI,EAEZ9D,EACFjF,KAAKO,SAAWwI,GAE1B,qCAIIH,kBA/RJ,SA+RA,KACM5I,KAAKa,aAAe0F,EACpBlB,GAAYA,IACZrF,KAAKkJ,MAAMD,EAAOrI,MAAO2F,GAEvB4C,QAAQvI,MAAM2F,IAGlBuC,SAvSJ,WAwSM,OAAO9I,KAAKwH,SAAQ,IAEtBH,YA1SJ,SA0SA,4BACM,GAAKrH,KAAK8B,YAAekF,EAAzB,CAIA,IAAN,yBACM,GAAKoC,EAAInC,OAAT,CAIIxB,GACFC,EAAIC,YAAY,CACd0D,MAAM,EACNzD,MAAOC,IAKX,IAAN,6BACA,YAEA,IACU7D,IACFsH,EAAOA,EAAKtH,OAAOA,IAGrBsH,EAAKxH,WAAW9B,KAAK0D,gBAAgBvB,MAAM,CACzCoH,IAAKC,EAAMC,GAAGL,KAChB,SAAN,kBACQnD,GAAWA,EAAQC,EAAIuC,QACnB,EAAZ,qBACU,EAAV,UAEU,EAAV,iBAEA,mBACQnC,GAAQA,EAAKC,GACTC,GACFd,EAAIe,UAAU,CACZC,QAASH,EAAII,QACbC,YAAY,OAGxB,oBACYnB,GACFC,EAAImB,cAENC,GAAYA,UAGhB4C,WA5VJ,SA4VA,GAGM,IAFA,IAAN,aACA,gBACA,uBACQ,IAAR,sBACYC,GAAS,IACXC,EAAGC,OAAOlF,EAAG,GACbmF,EAAGD,OAAOF,EAAO,MAIvBX,eAvWJ,SAuWA,KACUhJ,KAAK+J,oBACP/J,KAAK+J,oBAAoBzJ,EAAMN,KAAKgE,SAAUhE,KAAKS,oBAEnDT,KAAKkJ,MAAMzH,EAAMnB,EAAMN,KAAKgE,SAAUhE,KAAKS,uB","file":"node-modules/@dcloudio/uni-cli-shared/components/unicloud-db.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./unicloud-db.vue?vue&type=template&id=8ef09edc&\"\nvar renderjs\nimport script from \"./unicloud-db.vue?vue&type=script&lang=js&\"\nexport * from \"./unicloud-db.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/uni-cli-shared/components/unicloud-db.vue\"\nexport default component.exports","export * from \"-!../../vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../webpack-uni-mp-loader/lib/template.js!../../vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../webpack-uni-mp-loader/lib/style.js!./unicloud-db.vue?vue&type=template&id=8ef09edc&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  {\n    _vm.$setScopedSlotsParams(\"default\", {\n      options: _vm.options,\n      data: _vm.dataList,\n      pagination: _vm.paginationInternal,\n      loading: _vm.loading,\n      hasMore: _vm.hasMore,\n      error: _vm.errorMessage\n    })\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../babel-loader/lib/index.js!../../vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../webpack-uni-mp-loader/lib/script.js!../../vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../webpack-uni-mp-loader/lib/style.js!./unicloud-db.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../babel-loader/lib/index.js!../../vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../webpack-uni-mp-loader/lib/script.js!../../vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../webpack-uni-mp-loader/lib/style.js!./unicloud-db.vue?vue&type=script&lang=js&\"","<template>\n  <view>\n    <slot\n      :options=\"options\"\n      :data=\"dataList\"\n      :pagination=\"paginationInternal\"\n      :loading=\"loading\"\n      :hasMore=\"hasMore\"\n      :error=\"errorMessage\"\n    />\n  </view>\n</template>\n\n<script>\nimport { initVueI18n } from '@dcloudio/uni-i18n'\nimport messages from './i18n/index'\n\nconst { t } = initVueI18n(messages)\n\nconst events = {\n  load: 'load',\n  error: 'error'\n}\nconst pageMode = {\n  add: 'add',\n  replace: 'replace'\n}\nconst loadMode = {\n  auto: 'auto',\n  onready: 'onready',\n  manual: 'manual'\n}\n\nconst attrs = [\n  'pageCurrent',\n  'pageSize',\n  'spaceInfo',\n  'collection',\n  'action',\n  'field',\n  'getcount',\n  'orderby',\n  'where',\n  'groupby',\n  'groupField',\n  'distinct'\n]\n\nexport default {\n  name: 'UniClouddb',\n  props: {\n    options: {\n      type: [Object, Array],\n      default () {\n        return {}\n      }\n    },\n    spaceInfo: {\n      type: Object,\n      default () {\n        return {}\n      }\n    },\n    collection: {\n      type: [String, Array],\n      default: ''\n    },\n    action: {\n      type: String,\n      default: ''\n    },\n    field: {\n      type: String,\n      default: ''\n    },\n    orderby: {\n      type: String,\n      default: ''\n    },\n    where: {\n      type: [String, Object],\n      default: ''\n    },\n    pageData: {\n      type: String,\n      default: 'add'\n    },\n    pageCurrent: {\n      type: Number,\n      default: 1\n    },\n    pageSize: {\n      type: Number,\n      default: 20\n    },\n    getcount: {\n      type: [Boolean, String],\n      default: false\n    },\n    getone: {\n      type: [Boolean, String],\n      default: false\n    },\n    gettree: {\n      type: [Boolean, String, Object],\n      default: false\n    },\n    gettreepath: {\n      type: [Boolean, String],\n      default: false\n    },\n    startwith: {\n      type: String,\n      default: ''\n    },\n    limitlevel: {\n      type: Number,\n      default: 10\n    },\n    groupby: {\n      type: String,\n      default: ''\n    },\n    groupField: {\n      type: String,\n      default: ''\n    },\n    distinct: {\n      type: [Boolean, String],\n      default: false\n    },\n    pageIndistinct: {\n      type: [Boolean, String],\n      default: false\n    },\n    foreignKey: {\n      type: String,\n      default: ''\n    },\n    loadtime: {\n      type: String,\n      default: 'auto'\n    },\n    manual: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data () {\n    return {\n      loading: false,\n      hasMore: false,\n      dataList: this.getone ? undefined : [],\n      paginationInternal: {},\n      errorMessage: ''\n    }\n  },\n  computed: {\n    collectionArgs () {\n      return Array.isArray(this.collection) ? this.collection : [this.collection]\n    },\n    isLookup () {\n      return (Array.isArray(this.collection) && this.collection.length > 1) || (typeof this.collection === 'string' && this.collection.indexOf(',') > -1)\n    },\n    mainCollection () {\n      if (typeof this.collection === 'string') {\n        return this.collection.split(',')[0]\n      }\n      const mainQuery = JSON.parse(JSON.stringify(this.collection[0]))\n      return mainQuery.$db[0].$param[0]\n    }\n  },\n  created () {\n    this._isEnded = false\n    this.paginationInternal = {\n      current: this.pageCurrent,\n      size: this.pageSize,\n      count: 0\n    }\n\n    this.$watch(() => {\n      var al = []\n      attrs.forEach(key => {\n        al.push(this[key])\n      })\n      return al\n    }, (newValue, oldValue) => {\n      this.paginationInternal.size = this.pageSize\n      if (newValue[0] !== oldValue[0]) {\n        this.paginationInternal.current = this.pageCurrent\n      }\n      if (this.loadtime === loadMode.manual) {\n        return\n      }\n\n      let needReset = false\n      for (let i = 2; i < newValue.length; i++) {\n        if (newValue[i] !== oldValue[i]) {\n          needReset = true\n          break\n        }\n      }\n      if (needReset) {\n        this.clear()\n        this.reset()\n      }\n\n      this._execLoadData()\n    })\n\n    // #ifdef H5\n    if (process.env.NODE_ENV === 'development') {\n      this._debugDataList = []\n      if (!window.unidev) {\n        window.unidev = {\n          clientDB: {\n            data: []\n          }\n        }\n      }\n      window.unidev.clientDB.data.push(this._debugDataList)\n    }\n    // #endif\n\n    // #ifdef MP-TOUTIAO\n    let changeName\n    const events = this.$scope.dataset.eventOpts || []\n    for (var i = 0; i < events.length; i++) {\n      const event = events[i]\n      if (event[0].includes('^load')) {\n        changeName = event[1][0][0]\n      }\n    }\n    if (changeName) {\n      let parent = this.$parent\n      let maxDepth = 16\n      this._changeDataFunction = null\n      while (parent && maxDepth > 0) {\n        const fun = parent[changeName]\n        if (fun && typeof fun === 'function') {\n          this._changeDataFunction = fun\n          maxDepth = 0\n          break\n        }\n        parent = parent.$parent\n        maxDepth--\n      }\n    }\n    // #endif\n\n    if (!this.manual && this.loadtime === loadMode.auto) {\n      this.loadData()\n    }\n  },\n  // #ifdef H5\n  beforeDestroy () {\n    if (process.env.NODE_ENV === 'development' && window.unidev) {\n      var cd = this._debugDataList\n      var dl = window.unidev.clientDB.data\n      for (var i = dl.length - 1; i >= 0; i--) {\n        if (dl[i] === cd) {\n          dl.splice(i, 1)\n          break\n        }\n      }\n    }\n  },\n  // #endif\n  methods: {\n    loadData (args1, args2) {\n      let callback = null\n      let clear = false\n      if (typeof args1 === 'object') {\n        if (args1.clear) {\n          if (this.pageData === pageMode.replace) {\n            this.clear()\n          } else {\n            clear = args1.clear\n          }\n          this.reset()\n        }\n        if (args1.current !== undefined) {\n          this.paginationInternal.current = args1.current\n        }\n        if (typeof args2 === 'function') {\n          callback = args2\n        }\n      } else if (typeof args1 === 'function') {\n        callback = args1\n      }\n\n      this._execLoadData(callback, clear)\n    },\n    loadMore () {\n      if (this._isEnded || this.loading) {\n        return\n      }\n\n      if (this.pageData === pageMode.add) {\n        this.paginationInternal.current++\n      }\n\n      this._execLoadData()\n    },\n    refresh () {\n      this.clear()\n      this._execLoadData()\n    },\n    clear () {\n      this._isEnded = false\n      this.dataList = []\n    },\n    reset () {\n      this.paginationInternal.current = 1\n    },\n    add (value, {\n      action,\n      showToast = true,\n      toastTitle,\n      success,\n      fail,\n      complete,\n      needConfirm = true,\n      needLoading = true,\n      loadingTitle = ''\n    } = {}) {\n      if (needLoading) {\n        uni.showLoading({\n          title: loadingTitle\n        })\n      }\n      /* eslint-disable no-undef */\n      let db = uniCloud.database(this.spaceInfo)\n      if (action) {\n        db = db.action(action)\n      }\n\n      db.collection(this.mainCollection).add(value).then((res) => {\n        success && success(res)\n        if (showToast) {\n          uni.showToast({\n            title: toastTitle || t('uniCloud.component.add.success')\n          })\n        }\n      }).catch((err) => {\n        fail && fail(err)\n        if (needConfirm) {\n          uni.showModal({\n            content: err.message,\n            showCancel: false\n          })\n        }\n      }).finally(() => {\n        if (needLoading) {\n          uni.hideLoading()\n        }\n        complete && complete()\n      })\n    },\n    remove (id, {\n      action,\n      success,\n      fail,\n      complete,\n      confirmTitle,\n      confirmContent,\n      needConfirm = true,\n      needLoading = true,\n      loadingTitle = ''\n    } = {}) {\n      if (!id || !id.length) {\n        return\n      }\n      if (!needConfirm) {\n        this._execRemove(id, action, success, fail, complete, needConfirm, needLoading, loadingTitle)\n        return\n      }\n      uni.showModal({\n        title: confirmTitle || t('uniCloud.component.remove.showModal.title'),\n        content: confirmContent || t('uniCloud.component.remove.showModal.content'),\n        showCancel: true,\n        success: (res) => {\n          if (!res.confirm) {\n            return\n          }\n          this._execRemove(id, action, success, fail, complete, needConfirm, needLoading, loadingTitle)\n        }\n      })\n    },\n    update (id, value, {\n      action,\n      showToast = true,\n      toastTitle,\n      success,\n      fail,\n      complete,\n      needConfirm = true,\n      needLoading = true,\n      loadingTitle = ''\n    } = {}) {\n      if (needLoading) {\n        uni.showLoading({\n          title: loadingTitle\n        })\n      }\n      /* eslint-disable no-undef */\n      let db = uniCloud.database(this.spaceInfo)\n      if (action) {\n        db = db.action(action)\n      }\n\n      return db.collection(this.mainCollection).doc(id).update(value).then((res) => {\n        success && success(res)\n        if (showToast) {\n          uni.showToast({\n            title: toastTitle || t('uniCloud.component.update.success')\n          })\n        }\n      }).catch((err) => {\n        fail && fail(err)\n        if (needConfirm) {\n          uni.showModal({\n            content: err.message,\n            showCancel: false\n          })\n        }\n      }).finally(() => {\n        if (needLoading) {\n          uni.hideLoading()\n        }\n        complete && complete()\n      })\n    },\n    getTemp (isTemp = true) {\n      /* eslint-disable no-undef */\n      let db = uniCloud.database(this.spaceInfo)\n\n      if (this.action) {\n        db = db.action(this.action)\n      }\n\n      db = db.collection(...this.collectionArgs)\n\n      if (!(!this.where || !Object.keys(this.where).length)) {\n        db = db.where(this.where)\n      }\n      if (this.field) {\n        db = db.field(this.field)\n      }\n      if (this.foreignKey) {\n        db = db.foreignKey(this.foreignKey)\n      }\n      if (this.groupby) {\n        db = db.groupBy(this.groupby)\n      }\n      if (this.groupField) {\n        db = db.groupField(this.groupField)\n      }\n      if (this.distinct === true) {\n        db = db.distinct()\n      }\n      if (this.orderby) {\n        db = db.orderBy(this.orderby)\n      }\n\n      const {\n        current,\n        size\n      } = this.paginationInternal\n      const getOptions = {}\n      if (this.getcount) {\n        getOptions.getCount = this.getcount\n      }\n      const treeOptions = {\n        limitLevel: this.limitlevel,\n        startWith: this.startwith\n      }\n      if (this.gettree) {\n        getOptions.getTree = treeOptions\n      }\n      if (this.gettreepath) {\n        getOptions.getTreePath = treeOptions\n      }\n      db = db.skip(size * (current - 1)).limit(size)\n\n      if (isTemp) {\n        db = db.getTemp(getOptions)\n        db.udb = this\n      } else {\n        db = db.get(getOptions)\n      }\n\n      return db\n    },\n    setResult (result) {\n      if (result.code === 0) {\n        this._execLoadDataSuccess(result)\n      } else {\n        this._execLoadDataFail(new Error(result.message))\n      }\n    },\n    _execLoadData (callback, clear) {\n      if (this.loading) {\n        return\n      }\n      this.loading = true\n      this.errorMessage = ''\n\n      this._getExec().then((res) => {\n        this.loading = false\n        this._execLoadDataSuccess(res.result, callback, clear)\n\n        // #ifdef H5\n        if (process.env.NODE_ENV === 'development') {\n          this._debugDataList.length = 0\n          const formatData = JSON.parse(JSON.stringify(this.dataList))\n          if (Array.isArray(this.dataList)) {\n            this._debugDataList.push(...formatData)\n          } else {\n            this._debugDataList.push(formatData)\n          }\n        }\n        // #endif\n      }).catch((err) => {\n        this.loading = false\n        this._execLoadDataFail(err, callback)\n      })\n    },\n    _execLoadDataSuccess (result, callback, clear) {\n      const {\n        data,\n        count\n      } = result\n      this._isEnded = count !== undefined ? (this.paginationInternal.current * this.paginationInternal.size >= count) : (data.length < this.pageSize)\n      this.hasMore = !this._isEnded\n\n      const data2 = this.getone ? (data.length ? data[0] : undefined) : data\n\n      if (this.getcount) {\n        this.paginationInternal.count = count\n      }\n\n      callback && callback(data2, this._isEnded, this.paginationInternal)\n      this._dispatchEvent(events.load, data2)\n\n      if (this.getone || this.pageData === pageMode.replace) {\n        this.dataList = data2\n      } else {\n        if (clear) {\n          this.dataList = data2\n        } else {\n          this.dataList.push(...data2)\n        }\n      }\n    },\n    _execLoadDataFail (err, callback) {\n      this.errorMessage = err\n      callback && callback()\n      this.$emit(events.error, err)\n      if (process.env.NODE_ENV === 'development') {\n        console.error(err)\n      }\n    },\n    _getExec () {\n      return this.getTemp(false)\n    },\n    _execRemove (id, action, success, fail, complete, needConfirm, needLoading, loadingTitle) {\n      if (!this.collection || !id) {\n        return\n      }\n\n      const ids = Array.isArray(id) ? id : [id]\n      if (!ids.length) {\n        return\n      }\n\n      if (needLoading) {\n        uni.showLoading({\n          mask: true,\n          title: loadingTitle\n        })\n      }\n\n      /* eslint-disable no-undef */\n      const db = uniCloud.database(this.spaceInfo)\n      const dbCmd = db.command\n\n      let exec = db\n      if (action) {\n        exec = exec.action(action)\n      }\n\n      exec.collection(this.mainCollection).where({\n        _id: dbCmd.in(ids)\n      }).remove().then((res) => {\n        success && success(res.result)\n        if (this.pageData === pageMode.replace) {\n          this.refresh()\n        } else {\n          this.removeData(ids)\n        }\n      }).catch((err) => {\n        fail && fail(err)\n        if (needConfirm) {\n          uni.showModal({\n            content: err.message,\n            showCancel: false\n          })\n        }\n      }).finally(() => {\n        if (needLoading) {\n          uni.hideLoading()\n        }\n        complete && complete()\n      })\n    },\n    removeData (ids) {\n      const il = ids.slice(0)\n      const dl = this.dataList\n      for (let i = dl.length - 1; i >= 0; i--) {\n        const index = il.indexOf(dl[i]._id)\n        if (index >= 0) {\n          dl.splice(i, 1)\n          il.splice(index, 1)\n        }\n      }\n    },\n    _dispatchEvent (type, data) {\n      if (this._changeDataFunction) {\n        this._changeDataFunction(data, this._isEnded, this.paginationInternal)\n      } else {\n        this.$emit(type, data, this._isEnded, this.paginationInternal)\n      }\n    }\n  }\n}\n</script>\n"],"sourceRoot":""}